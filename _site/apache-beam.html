<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Apache Beam</title>
  <meta name="description" content="Apache Beam 소개">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">


  <!-- Plase Dont Go -->
  <script type="text/javascript" src="/js/pleaseDontGo.js"></script>
  <script type="text/javascript">
    pleaseDontGo.init({
      newTitle: 'Come back!',
      newFavicon: '/img/pleaseDontGo.ico',
      timeout: 1000
    });
  </script>


  <!-- Google Analytics-->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-85815564-2', 'auto');
    ga('send', 'pageview');

  </script>
</head>


<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">BLOG</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="/about" title="ABOUT">ABOUT</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  

    <!-- Nav links -->
	  
<a href="https://github.com/sungjunyoung">GITHUB</a>


	</div>

  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.0.0</span>

</footer>
	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="/">
        <h1>
          <span>JUNYOUNG</span>BLOG
        </h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
	    
	      
	    
	      
	        <a href="/about" title="ABOUT">ABOUT</a>
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    

      <!-- Nav links -->
	    
<a href="https://github.com/sungjunyoung">GITHUB</a>


    </span>
  </div>
</header>

      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
	<h2>Apache Beam</h2>
	<time datetime="2017-03-13T00:00:00+09:00" class="by-line">13 Mar 2017</time>
	<div class="content">

		<p><img src="img/beam_logo_s.png" alt="Beam Logo" /></p>

<p><a href="https://summerofcode.withgoogle.com/">GSoC</a>에 참가하기 위해 프로젝트 리스트를 보다가 <a href="https://beam.apache.org/">Apache Beam</a>을 알게되었습니다. Apache Beam 프로젝트는 스트리밍 데이터 처리 작업을 할 수 있도록 프로그래밍 모델을 제공합니다.</p>

<p>현재 도큐멘테이션이 미완인 상태인데, GSoC(Google Summer of Code) 에서 기존 셰익스피어의 단어 빈도를 기본 TF-IDF로 분석하는 예제보다 <a href="https://issues.apache.org/jira/browse/BEAM-1439?filter=12339687">더 확장되고 고급화된 파이프라인을 작성하는 이슈</a>가 올라와 있어 열심히 분석중입니다.</p>

<blockquote>
  <p>Apache Beam provides an advanced unified programming model, allowing you to implement batch and streaming data processing jobs that can run on any execution engine.</p>
</blockquote>

<p>계속 업데이트되거나 추가되는 스트리밍 데이터에 대해 변경, 필터링, 그룹화, 분석 등의 작업을 수행하고(transform), 윈도우라는 개념을 적용해 파일로 저장하거나, DB에 쓰는 작업 등을 할 수 있습니다. (제공되는 <a href="https://beam.apache.org/documentation/sdks/java/">I/O Connector들</a>도 연결할 수 있습니다.)  이 일련의 작업들은 사용자가 정의한 파이프라인 내에서 이루어지며, 모든 작업은 비동기적, 병렬적으로 이루어집니다.</p>

<p>여기서 윈도우란, 스트리밍 데이터를 정해진 사이즈 혹은 특정 지점을 기준으로 나누어 저장하는 컨셉입니다.</p>

<p>transform 작업을 수행할 때, 모든 transform 은 PCollection 이라는 타입으로 리턴되므로 함수 체이닝 을 통해 계속적으로 다른 작업들을 수행할 수 있습니다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[Final Output PCollection] = [Initial Input PCollection].apply([First Transform])
.apply([Second Transform])
.apply([Third Transform])
</code></pre>
</div>

<p>도큐멘테이션을 번역해보고 슬쩍 작성해본 <code class="highlighter-rouge">ArrayList&lt;String&gt;</code>의 각 원소의 문자열 길이를 출력하는 파이프라인입니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">sungjunyoung</span><span class="o">.</span><span class="na">github</span><span class="o">.</span><span class="na">io</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.coders.TextualIntegerCoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.io.TextIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.options.PipelineOptions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.options.PipelineOptionsFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.transforms.Create</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.transforms.DoFn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.transforms.ParDo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.beam.sdk.values.PCollection</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestPipeline</span> <span class="o">{</span>

	<span class="kd">static</span> <span class="kd">class</span> <span class="nc">ComputeWordLengthFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
		<span class="nd">@ProcessElement</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processElement</span><span class="o">(</span><span class="n">ProcessContext</span> <span class="n">c</span><span class="o">){</span>
			<span class="n">String</span> <span class="n">word</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">element</span><span class="o">();</span>
			<span class="n">c</span><span class="o">.</span><span class="na">output</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

		<span class="n">PipelineOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="n">PipelineOptionsFactory</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
		<span class="n">Pipeline</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">options</span><span class="o">);</span>

		<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
		<span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"안녕하세요"</span><span class="o">);</span>
		<span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"저는"</span><span class="o">);</span>
		<span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"성준영입니다."</span><span class="o">);</span>
		<span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"경희대학교 컴퓨터공학과에"</span><span class="o">);</span>
		<span class="n">temp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"3학년으로 재학중입니다."</span><span class="o">);</span>

                <span class="c1">// in-mememory 데이터에서 PCollection 을 만듭니다.</span>
		<span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Create</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">temp</span><span class="o">));</span>     
                <span class="c1">// 정의된 DoFn 을 상속받는 ComputeWordLengthFn 을 적용해 test 의 라인별 단어 갯수를 계산합니다.</span>
		<span class="n">PCollection</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">testLength</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">ParDo</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputeWordLengthFn</span><span class="o">()));</span>

                <span class="c1">//test-output 이라는 prefix 로 .txt 확장자를 가진 파일들을 출력합니다. 타입이 Integer이므로 코더를 TextualIntegerCoder로 설정합니다.</span>
		<span class="n">testLength</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="s">"WriteNumbers"</span><span class="o">,</span><span class="n">TextIO</span><span class="o">.</span><span class="na">Write</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"test-output"</span><span class="o">).</span><span class="na">withSuffix</span><span class="o">(</span><span class="s">".txt"</span><span class="o">).</span><span class="na">withCoder</span><span class="o">(</span><span class="n">TextualIntegerCoder</span><span class="o">.</span><span class="na">of</span><span class="o">()));</span>
		<span class="n">p</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>실행시키면, <code class="highlighter-rouge">test-output-00000-of-00003.txt</code>, <code class="highlighter-rouge">test-output-00001-of-00003.txt</code>, <code class="highlighter-rouge">test-output-00002-of-00003.txt</code> 이 나올수도 있고, 안나올수도 있습니다(?) 비동기적으로 transform 이 수행되기 때문에, 실행 시 처리 속도에 따라 window로 파일이 나뉘어져 출력되게 됩니다. 즉, 파일은 몇 개가 출력될지 모릅니다.</p>

<p><code class="highlighter-rouge">ArrayList&lt;String&gt;</code>에는 <code class="highlighter-rouge">["안녕하세요", "저는", "성준영입니다.", "경희대학교 컴퓨터공학과에", "3학년으로 재학중입니다."]</code> 로 넣었기 때문에, 출력 파일에는 순서대로 5 2 7 13 13 이 나올 것이라 기대했지만,</p>

<p><code class="highlighter-rouge">test-output-00000-of-00003.txt</code> =&gt; 2   7<br />
<code class="highlighter-rouge">test-output-00001-of-00003.txt</code> =&gt; 13  13<br />
<code class="highlighter-rouge">test-output-00001-of-00003.txt</code> =&gt; 5</p>

<p>순서는 상관없이 Beam 내부 로직에 따라 처리되는 순서로 windowing 되어 출력됩니다.</p>

<p>지금까지 간단한 Apache Beam 소개였습니다. MongoDB, JDBC, Google BigQuery, Apache Kafka, HBase 등 많은 IO Connector 들을 지원하니 Kafka 에 쌓여지는 스트리밍 데이터들을 Beam 을 통해 형식화 하여 MongoDB 에 계속 쌓는다던지 하는 작업들이 가능하겠네요.</p>

<blockquote>
  <p>미천한 영어실력으로 번역한 <a href="https://github.com/sungjunyoung/apache_beam_doc_ko">github repo</a>도 놀러오세요 :)</p>
</blockquote>


	</div>
	<div id="disqus_thread"></div>
	<script>
		/**
		 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
		/*
		var disqus_config = function () {
		this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
		this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		*/
		(function() { // DON'T EDIT BELOW THIS LINE
			var d = document,
				s = d.createElement('script');
			s.src = 'https://blog-csficscaal.disqus.com/embed.js';
			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</article>


	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer><span>@2017 based on monochrome</span></footer>


	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
